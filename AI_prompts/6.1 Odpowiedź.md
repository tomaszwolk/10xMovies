PrzeanalizujÄ™ plik z podsumowaniem planowania bazy danych pod kÄ…tem spÃ³jnoÅ›ci i moÅ¼liwych uproszczeÅ„ dla MVP.

[2 tools called]

PrzeanalizujÄ™ plik podsumowania pod kÄ…tem spÃ³jnoÅ›ci, niepotrzebnych elementÃ³w i moÅ¼liwoÅ›ci konsolidacji.

## Analiza Podsumowania - GÅ‚Ã³wne Ustalenia

### âœ… **Elementy SpÃ³jne i Poprawne**

1. **Struktura gÅ‚Ã³wna** - dobrze zdefiniowane encje: users, movies, platforms, watchlist, availability
2. **RLS** - spÃ³jna strategia bezpieczeÅ„stwa z dostÄ™pem przez backend
3. **Partycjonowanie** - logiczne dla tabel z duÅ¼Ä… iloÅ›ciÄ… danych
4. **Naturalny PK** `tconst` - dobry wybÃ³r dla integracji z IMDb

### âš ï¸ **Potencjalne NiespÃ³jnoÅ›ci**

1. **`search_query` - czy osobna tabela czy typ eventu?**
   - Punkt 14: "logowanie zapytaÅ„ wyszukiwania (`search_query`)" - sugeruje czÄ™Å›Ä‡ `event`
   - Punkt 22 i rozstrzygniÄ™cie 1: traktuje jako osobnÄ… partycjonowanÄ… tabelÄ™
   - **W migracji SQL**: osobna tabela partycjonowana
   - **Wniosek**: NiespÃ³jnoÅ›Ä‡ w dokumencie - powinna byÄ‡ wyjaÅ›niona

2. **`users` vs `auth_user`**
   - Podsumowanie uÅ¼ywa nazwy `users`
   - Migracja SQL i db-plan uÅ¼ywajÄ… `auth_user`
   - **Zalecenie**: UjednoliciÄ‡ nazewnictwo w dokumentacji

### ğŸ”§ **MoÅ¼liwe Uproszczenia dla MVP**

#### **1. PoÅ‚Ä…czyÄ‡ `movie_assets` z `movie` â­ WAÅ»NE**
```
Aktualne:
- movie (9 pÃ³l)
- movie_assets (2 pola + tconst PK)

Uproszczone:
- movie (11 pÃ³l)
```
**Uzasadnienie**: Tylko 2 pola (poster_path, poster_last_checked), relacja 1:1, bez korzyÅ›ci z osobnej tabeli w MVP.

#### **2. UsunÄ…Ä‡ `country` i `region_map` w MVP** â­
```
Aktualne: 
- country (sÅ‚ownik krajÃ³w)
- region_map (mapowanie Watchmodeâ†’ISO)

Uproszczone:
- HardcodowaÄ‡ 'PL' w movie_availability
- FK do country.code â†’ zmieniÄ‡ na CHECK (region_code = 'PL')
```
**Uzasadnienie**: MVP tylko Polska, 2 dodatkowe tabele dla 1 wartoÅ›ci to over-engineering.

#### **3. UsunÄ…Ä‡ `platform_external` w MVP** â­
```
Aktualne:
- platform_external (mapowania Watchmode/TMDBâ†’platform.id)

Uproszczone:
- Mapowania w konfiguracji Django (settings.py lub const.py)
```
**Uzasadnienie**: 5 platform Ã— 2 ÅºrÃ³dÅ‚a = ~10 rekordÃ³w, lepiej w kodzie niÅ¼ w DB.

#### **4. RozwaÅ¼yÄ‡ poÅ‚Ä…czenie `movie_external_ids` z `movie`**
```
Aktualne:
- movie_external_ids (tconst PK, tmdb_id, watchmode_id)

Potencjalnie:
- movie (+ tmdb_id, watchmode_id)
```
**Uzasadnienie**: Relacja 1:1, ale osobna tabela ma sens dla:
- Unikalne indeksy czÄ™Å›ciowe na NULL
- Separacja danych "czysto IMDb" od integracji
**Zalecenie**: ZOSTAWIÄ† jako osobnÄ… tabelÄ™ (dobra normalizacja).

#### **5. UproÅ›ciÄ‡ `availability_refresh_run`**
```
Aktualne pola:
- started_at, completed_at, status
- movies_checked, movies_updated, errors_count
- error_message

Dla MVP wystarczy:
- started_at, completed_at, status
- movies_updated
```
**Uzasadnienie**: SzczegÃ³Å‚owe metryki (movies_checked, errors_count) mogÄ… byÄ‡ logowane do `integration_error_log`.

#### **6. RozwaÅ¼yÄ‡ usuniÄ™cie `analytics_daily_snapshot` w MVP**
```
Pytanie: Czy w MVP potrzebne sÄ… dzienne snapshoty?
- Metryki mogÄ… byÄ‡ liczone on-demand z tabel event/users
- DodaÄ‡ w wersji 1.1 gdy bÄ™dzie potrzeba optymalizacji
```
**Zalecenie**: JeÅ›li nie ma konkretnego wymagania dashboardu analitycznego, **ODÅOÅ»YÄ†**.

#### **7. RozwaÅ¼yÄ‡ uproszczenie `mv_movies_in_use`**
```
Pytanie: Czy w MVP potrzebny materializowany widok?
- UÅ¼ywany do priorytetyzacji odÅ›wieÅ¼ania dostÄ™pnoÅ›ci
- W MVP z maÅ‚Ä… bazÄ… uÅ¼ytkownikÃ³w moÅ¼e byÄ‡ query on-demand
```
**Zalecenie**: JeÅ›li Ğ±Ğ°Ğ·Ğ° < 10K filmÃ³w w uÅ¼yciu, **ODÅOÅ»YÄ†** do v1.1.

#### **8. Konsolidacja logÃ³w - `event` vs `search_query`**
```
Aktualne:
- event (event_type, properties JSONB)
- search_query (query_text, results_count)

Uproszczone:
- event z typem 'search' i properties: {query, results_count}
```
**Uzasadnienie**: 
- Jedna tabela partycjonowana zamiast dwÃ³ch
- Mniej kodu maintenance (partycje, czyszczenie)
- SpÃ³jna struktura analytics

---

## ğŸ“‹ **Konkretne Zalecenia dla Rewizji**

### **Priorytet 1 - Uproszczenia obowiÄ…zkowe:**

1. âœ… **PoÅ‚Ä…czyÄ‡ `movie_assets` â†’ `movie`**
2. âœ… **UsunÄ…Ä‡ `country` i `region_map`** - hardcodowaÄ‡ 'PL'
3. âœ… **UsunÄ…Ä‡ `platform_external`** - mapowania w kodzie
4. âœ… **PoÅ‚Ä…czyÄ‡ `search_query` â†’ `event`** - jeden typ eventu

### **Priorytet 2 - Do dyskusji:**

5. âš ï¸ **UproÅ›ciÄ‡ `availability_refresh_run`** - mniej metryk
6. âš ï¸ **OdÅ‚oÅ¼yÄ‡ `analytics_daily_snapshot`** - na v1.1?
7. âš ï¸ **OdÅ‚oÅ¼yÄ‡ `mv_movies_in_use`** - na v1.1?

---

## ğŸ“ **Podsumowanie korzyÅ›ci z uproszczeÅ„:**

### **Przed:**
- 15 tabel gÅ‚Ã³wnych + 3 staging = 18 tabel
- 3 tabele partycjonowane
- 2 materializowane widoki/snapshoty

### **Po (Priorytet 1):**
- **11 tabel gÅ‚Ã³wnych** + 3 staging = 14 tabel (-22%)
- **2 tabele partycjonowane** (event, integration_error_log)
- **Opcjonalnie 0-1** materializowany widok

### **KorzyÅ›ci:**
- âš¡ Mniej JOIN-Ã³w (movie_assets w movie)
- ğŸ”§ Prostszy maintenance (mniej partycji)
- ğŸ“‰ Mniej boilerplate (RLS, triggers, indeksy)
- ğŸš€ Szybszy development MVP
- ğŸ¯ YAGNI - nie budujemy tego czego nie potrzebujemy

---

Czy chcesz, Å¼ebym:
1. **ZaktualizowaÅ‚ plik podsumowania** z tymi uproszczeniami?
2. **ZmodyfikowaÅ‚ migracjÄ™ SQL** zgodnie z rekomendacjami?
3. **StworzyÅ‚ porÃ³wnanie** przed/po dla konkretnych tabel?