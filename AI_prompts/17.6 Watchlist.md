Jako starszy programista frontendu Twoim zadaniem jest stworzenie szczegółowego planu wdrożenia nowego widoku w aplikacji internetowej. Plan ten powinien być kompleksowy i wystarczająco jasny dla innego programisty frontendowego, aby mógł poprawnie i wydajnie wdrożyć widok.

Najpierw przejrzyj następujące informacje:

1. Product Requirements Document (PRD):
<prd>
@prd.md
</prd>

2. Opis widoku:
<view_description>
Widok: Dashboard – Watchlista
- Ścieżka widoku: `/app/watchlist`
- Główny cel: Centralne zarządzanie filmami do obejrzenia, z podglądem dostępności VOD i szybkim dodawaniem.
- Kluczowe informacje do wyświetlenia: kafelki/wiersze filmów (plakat/placeholder, tytuł, rok, ocena IMDb, gatunki), ikony dostępności VOD, badge „Niedostępne…”, data „Stan z: [data]”, licznik widocznych.
- Kluczowe komponenty widoku: App header, Search Combobox (limit 10), Toggle widoków (kafelki/lista), Sortowanie (dropdown), Filtry (checkbox „Tylko dostępne”, przycisk „Ukryj niedostępne”), Karta/Wiersz filmu z akcjami (Oznacz obejrzane, Usuń), Toastery, Paginacja/wirtualizacja (opcjonalnie), Przycisk „Zasugeruj filmy”.
- UX, dostępność i względy bezpieczeństwa: szybkie akcje z confirm dla usuwania, optimistic updates z opcją Undo, wyraźne stany filtrów, zapamiętywanie preferencji widoku/sortowania w sesji, focus states, minimalizacja skoków layoutu (lazy image + stałe wymiary).
</view_description>

3. User Stories:
<user_stories>
US-012: Przeglądanie watchlisty w widoku kafelkowym
Jako użytkownik chcę zobaczyć moją watchlistę w widoku kafelkowym, aby wizualnie ocenić moje filmy.

Kryteria akceptacji:
- Widok kafelkowy jest domyślnym widokiem watchlisty
- Każdy kafelek zawiera: poster filmu, tytuł, rok, ocenę IMDb, gatunki
- Kolorowe ikony platform VOD pokazują gdzie film jest dostępny
- Szary badge "Niedostępne na Twoich platformach" dla filmów niedostępnych
- Responsywny grid (3-4 kafelki per rząd na desktop, 1-2 na mobile)
- Checkbox/przycisk "Obejrzane" w rogu kafelka
- Przycisk "Usuń" (ikona kosza) w rogu kafelka

US-013: Przeglądanie watchlisty w widoku listowym
Jako power user chcę przełączyć się na widok listowy, aby zobaczyć więcej filmów jednocześnie.

Kryteria akceptacji:
- Przełącznik widoku (ikony grid/list) jest widoczny nad watchlistą
- Kliknięcie przełącza między widokiem kafelkowym a listowym
- Widok listowy wyświetla filmy w wierszach
- Każdy wiersz zawiera: małą miniaturę plakatu, tytuł, rok, ocenę, gatunki, ikony platform
- Więcej filmów widocznych bez scrollowania niż w widoku kafelkowym
- Przyciski "Obejrzane" i "Usuń" są widoczne w wierszu
- Preferowany widok jest zapamiętywany w sesji

US-014: Sortowanie watchlisty
Jako użytkownik chcę sortować moją watchlistę, aby łatwiej znaleźć interesujące mnie filmy.

Kryteria akceptacji:
- Dropdown "Sortuj" jest widoczny nad watchlistą
- Opcje sortowania: "Data dodania (najnowsze)", "Ocena IMDb (najwyższe)", "Rok produkcji"
- Domyślne sortowanie: "Data dodania (najnowsze)"
- Kliknięcie opcji natychmiast zmienia kolejność filmów
- Brak przeładowania strony (sortowanie po stronie klienta)
- Aktualnie wybrana opcja jest wizualnie zaznaczona
- Sortowanie działa zarówno w widoku kafelkowym jak i listowym

US-015: Filtrowanie watchlisty - tylko dostępne filmy
Jako użytkownik chcę zobaczyć tylko filmy dostępne na moich platformach, aby szybko wybrać co obejrzeć dziś.

Kryteria akceptacji:
- Checkbox "Tylko dostępne na moich platformach" jest widoczny nad watchlistą
- Domyślnie checkbox jest odznaczony (pokazywane wszystkie filmy)
- Po zaznaczeniu checkbox ukrywane są filmy z szarym badge'm "Niedostępne"
- Licznik "Wyświetlane: X/Y" pokazuje ile filmów jest widocznych
- Jeśli żaden film nie jest dostępny, komunikat: "Brak filmów dostępnych na Twoich platformach"
- Jeśli użytkownik nie wybrał platform, komunikat: "Wybierz platformy w profilu"
- Stan checkboxa jest zapamiętywany w sesji

US-017: Usuwanie filmu z watchlisty
Jako użytkownik chcę usunąć film z mojej watchlisty.

Kryteria akceptacji:
- Przycisk "Usuń" (ikona kosza) jest widoczny przy każdym filmie
- Po kliknięciu pojawia się confirm dialog: "Czy na pewno chcesz usunąć [tytuł] z watchlisty?"
- Opcje w dialogu: "Usuń" i "Anuluj"
- Kliknięcie "Anuluj" zamyka dialog bez zmian
- Kliknięcie "Usuń" usuwa film z widoku (soft delete z flagą deleted_at)
- Toast/snackbar: "Film został usunięty z watchlisty"
- Film pozostaje w bazie danych dla analytics

US-018: Pusta watchlista
Jako nowy użytkownik chcę zobaczyć pustą watchlistę, aby otrzymać instrukcję co zrobić dalej.

Kryteria akceptacji:
- Przy braku filmów wyświetlany jest komunikat: "Twoja watchlista jest pusta"
- Tekst pomocniczy: "Użyj wyszukiwarki powyżej aby dodać pierwsze filmy"
- Ikona/ilustracja pustego stanu (empty state)
- Wyszukiwarka jest widoczna i aktywna

US-019: Wyświetlanie dostępności filmów z Watchmode API
Jako użytkownik chcę zobaczyć na których platformach są dostępne filmy z mojej watchlisty, aby wiedzieć gdzie mogę je obejrzeć.

Kryteria akceptacji:
- Każdy film na watchliście wyświetla ikony platform VOD gdzie jest dostępny
- Ikony są kolorowe dla platform gdzie film jest dostępny
- Ikony są szare/niewidoczne dla platform gdzie film nie jest dostępny
- Tylko platformy wybrane w profilu użytkownika są brane pod uwagę dla badge'a
- Film dostępny na co najmniej jednej platformie użytkownika: kolorowe ikony
- Film niedostępny na żadnej platformie użytkownika: szary badge "Niedostępne na Twoich platformach"
- Tooltip/hover na ikonie pokazuje nazwę platformy

US-023: Oznaczenie filmu jako obejrzany
Jako użytkownik chcę oznaczyć film jako obejrzany, aby przenieść go do historii.

Kryteria akceptacji:
- Checkbox/przycisk "Obejrzane" jest widoczny przy każdym filmie na watchliście
- Po kliknięciu film znika z watchlisty
- Film pojawia się w zakładce "Obejrzane"
- Data obejrzenia jest automatycznie zapisywana jako data dzisiejsza
- Toast/snackbar: "Film został oznaczony jako obejrzany"
- Operacja jest natychmiastowa (brak przeładowania strony)

US-027: Generowanie sugestii AI
Jako użytkownik chcę otrzymać personalizowane sugestie filmów od AI, aby odkryć nowe ciekawe tytuły.

Kryteria akceptacji:
- Przycisk "Zasugeruj filmy" jest widoczny na watchliście
- Po kliknięciu wyświetlany jest loader/spinner z komunikatem "Generuję sugestie..."
- System pobiera: listę obejrzanych filmów (z gatunkami), watchlistę, platformy użytkownika
- Prompt jest wysyłany do Gemini-flash-lite API
- System otrzymuje 5 sugestii z tytułem, rokiem i uzasadnieniem
- Sugestie są wyświetlane w osobnej sekcji/modal
- Każda sugestia zawiera: plakat (TMDB), tytuł, rok, uzasadnienie (1-2 zdania), ikony dostępności
- Przycisk "Dodaj do watchlisty" przy każdej sugestii
- Sugestie są cache'owane na 24 godziny
- Flag "added_from_ai_suggestion" jest ustawiana przy dodaniu z sugestii

US-009: Wyszukiwanie filmu z autocomplete
Jako użytkownik chcę wyszukać film po tytule, aby dodać go do mojej watchlisty.

Kryteria akceptacji:
- Wyszukiwarka jest widoczna na stronie głównej
- Po wpisaniu minimum 2 znaków rozpoczyna się wyszukiwanie
- Dropdown z wynikami pojawia się poniżej pola wyszukiwania
- Maksymalnie 10 wyników jest wyświetlanych
- Każdy wynik zawiera: miniaturkę plakatu (50x75px), tytuł, rok w nawiasie, ocenę IMDb
- Wyniki są sortowane według trafności i oceny
- Placeholder pojawia się przy braku plakatu
- Kliknięcie na wynik dodaje film do watchlisty
- Komunikat potwierdzający dodanie pojawia się krótko (toast/snackbar)
</user_stories>

4. Endpoint Description:
<endpoint_description>
A) Główny endpoint do pobierania listy filmów na watchlistę użytkownika.
#### `GET /api/user-movies/`

-   **Description**: Retrieves the user's watchlist or watched history.
-   **Authentication**: Required (returns 401 when unauthenticated).
-   **Query Parameters**:
    -   `status` (string, required): `watchlist` or `watched`.
    -   `ordering` (string, optional): Allow-listed values: `-watchlisted_at`, `-tconst__avg_rating`.
    -   `is_available` (boolean, optional): If `true`, filter to movies available on at least one of the user's platforms; if `false`, filter to movies explicitly unavailable on all of the user's platforms (and with no `true` availability records). When omitted, no availability filter is applied.
-   **Success Response** (200 OK for `?status=watchlist`):
    ```json
    [
      {
        "id": 101,
        "movie": {
          "tconst": "tt0816692",
          "primary_title": "Interstellar",
          "start_year": 2014,
          "genres": ["Adventure", "Drama", "Sci-Fi"],
          "avg_rating": "8.6",
          "poster_path": "https://image.tmdb.org/t/p/w500/gEU2QniE6E77NI6lCU6MxlNBvIx.jpg"
        },
        "availability": [
          {"platform_id": 1, "platform_name": "Netflix", "is_available": true}
        ],
        "watchlisted_at": "2025-10-12T10:00:00Z"
      }
    ]
    ```
-   **Error Responses**:
    - `400 Bad Request`: Missing/invalid `status`; invalid `ordering`; invalid `is_available` boolean.
    - `401 Unauthorized`: Missing or invalid authentication.

B) Endpoint wykorzystywany przez komponent wyszukiwarki
#### `GET /api/movies/`

-   **Description**: Searches for movies.
-   **Authentication**: None (public endpoint).
-   **Query Parameters**:
    -   `search` (string): The search query for the movie title (e.g., `?search=interstellar`).
-   **Success Response** (200 OK):
    ```json
    [
      {
        "tconst": "tt0816692",
        "primary_title": "Interstellar",
        "start_year": 2014,
        "avg_rating": "8.6",
        "poster_path": "https://image.tmdb.org/t/p/w500/gEU2QniE6E77NI6lCU6MxlNBvIx.jpg"
      }
    ]
    ```

C) Endpoint wywoływany do dodania filmu do watchlisty
#### `POST /api/user-movies/`

-   **Description**: Adds a new movie to the user's watchlist.
-   **Authentication**: Required.
-   **Request Body**:
    ```json
    {
      "tconst": "tt0816692"
    }
    ```

-   **Success Response** (201 Created): Returns the newly created `user-movie` object.
  ```json
  {
    "id": 102,
    "movie": {
      "tconst": "tt0816692",
      "primary_title": "Interstellar",
      "start_year": 2014,
      "genres": ["Adventure", "Drama", "Sci-Fi"],
      "avg_rating": "8.6",
      "poster_path": "https://image.tmdb.org/t/p/w500/gEU2QniE6E77NI6lCU6MxlNBvIx.jpg"
    },
    "availability": [
      {"platform_id": 1, "platform_name": "Netflix", "is_available": true},
      {"platform_id": 2, "platform_name": "HBO Max", "is_available": false}
    ],
    "watchlisted_at": "2025-10-12T14:30:00Z",
    "watched_at": null
  }
  ```
-   **Error Responses**:
    -   `400 Bad Request`:
        - Missing `tconst` field in request body
        - Movie with given `tconst` does not exist in database
        - Invalid `tconst` format
    -   `401 Unauthorized`: Not authenticated.
    -   `409 Conflict`: Movie is already on the watchlist.

D) Wywoływany do zmiany statusu filmu, np. oznaczenia go jako obejrzany
#### `PATCH /api/user-movies/<id>/`

-   **Description**: Updates a user-movie entry. Used to move a movie to "watched", restore it to the watchlist, or soft-delete it.
-   **Authentication**: Required.
-   **Request Body** (to mark as watched):
    ```json
    {
      "action": "mark_as_watched"
    }
    ```

-   **Request Body** (to restore to watchlist):
    ```json
    {
      "action": "restore_to_watchlist"
    }
    ```

-   **Success Response** (200 OK): Returns the updated `user-movie` object.

E) Wywoływany po kliknięciu przycisku "Usuń" przy danym filmie.
#### `DELETE /api/user-movies/<id>/`

-   **Description**: Soft-deletes a movie from the user's watchlist.
-   **Authentication**: Required.
-   **Success Response** (204 No Content).

F) Wywoływany po kliknięciu przycisku "Zasugeruj filmy"
#### `GET /api/suggestions/`

-   **Description**: Generates or retrieves cached AI movie suggestions for the user.
-   **Authentication**: Required.
-   **Rate Limiting**: 1 request per calendar day (based on server date). User can receive new suggestions once per day, regardless of the exact time of previous request.
-   **Success Response** (200 OK):
    ```json
    {
      "expires_at": "2025-10-13T23:59:59Z",
      "suggestions": [
        {
          "tconst": "tt0133093",
          "primary_title": "The Matrix",
          "start_year": 1999,
          "justification": "Because you liked 'Inception', you might enjoy this classic sci-fi movie about simulated reality.",
          "availability": [
            {"platform_id": 2, "platform_name": "HBO Max", "is_available": true}
          ]
        }
      ]
    }
    ```
-   **Error Responses**:
    -   `429 Too Many Requests`: User has already received suggestions today.
    -   `404 Not Found`: User has no movies on their watchlist or watched history to base suggestions on.

</endpoint_description>

5. Endpoint Implementation:
<endpoint_implementation>
Endpointy /api/user-movies/* i /api/movies/:
Są zaimplementowane w dedykowanych aplikacjach w folderze apps. Główny plik urls.py @urls
Logika dla user-movies znajduje się w: myVOD/backend/apps/user_movies/views.py
Logika dla movies (wyszukiwarka) znajduje się w: myVOD/backend/apps/movies/views.py

Endpoint /api/suggestions/:
Ten endpoint, podobnie jak logowanie czy profil, jest zaimplementowany bezpośrednio w głównym module projektu:
Routing: myVOD/backend/myVOD/urls.py
Logika: myVOD/backend/myVOD/views.py, wewnątrz klasy AISuggestionsView

@views.py 
@views.py 
@urls.py
@views.py
</endpoint_implementation>

6. Type Definitions:
<type_definitions>
@api.types.ts @database.types.ts 
</type_definitions>

7. Tech Stack:
<tech_stack>
@tech-stack.md
</tech_stack>

Przed utworzeniem ostatecznego planu wdrożenia przeprowadź analizę i planowanie wewnątrz tagów <implementation_breakdown> w swoim bloku myślenia. Ta sekcja może być dość długa, ponieważ ważne jest, aby być dokładnym.

W swoim podziale implementacji wykonaj następujące kroki:
1. Dla każdej sekcji wejściowej (PRD, User Stories, Endpoint Description, Endpoint Implementation, Type Definitions, Tech Stack):
  - Podsumuj kluczowe punkty
 - Wymień wszelkie wymagania lub ograniczenia
 - Zwróć uwagę na wszelkie potencjalne wyzwania lub ważne kwestie
2. Wyodrębnienie i wypisanie kluczowych wymagań z PRD
3. Wypisanie wszystkich potrzebnych głównych komponentów, wraz z krótkim opisem ich opisu, potrzebnych typów, obsługiwanych zdarzeń i warunków walidacji
4. Stworzenie wysokopoziomowego diagramu drzewa komponentów
5. Zidentyfikuj wymagane DTO i niestandardowe typy ViewModel dla każdego komponentu widoku. Szczegółowo wyjaśnij te nowe typy, dzieląc ich pola i powiązane typy.
6. Zidentyfikuj potencjalne zmienne stanu i niestandardowe hooki, wyjaśniając ich cel i sposób ich użycia
7. Wymień wymagane wywołania API i odpowiadające im akcje frontendowe
8. Zmapuj każdej historii użytkownika do konkretnych szczegółów implementacji, komponentów lub funkcji
9. Wymień interakcje użytkownika i ich oczekiwane wyniki
10. Wymień warunki wymagane przez API i jak je weryfikować na poziomie komponentów
11. Zidentyfikuj potencjalne scenariusze błędów i zasugeruj, jak sobie z nimi poradzić
12. Wymień potencjalne wyzwania związane z wdrożeniem tego widoku i zasugeruj możliwe rozwiązania

Po przeprowadzeniu analizy dostarcz plan wdrożenia w formacie Markdown z następującymi sekcjami:

1. Przegląd: Krótkie podsumowanie widoku i jego celu.
2. Routing widoku: Określenie ścieżki, na której widok powinien być dostępny.
3. Struktura komponentów: Zarys głównych komponentów i ich hierarchii.
4. Szczegóły komponentu: Dla każdego komponentu należy opisać:
 - Opis komponentu, jego przeznaczenie i z czego się składa
 - Główne elementy HTML i komponenty dzieci, które budują komponent
 - Obsługiwane zdarzenia
 - Warunki walidacji (szczegółowe warunki, zgodnie z API)
 - Typy (DTO i ViewModel) wymagane przez komponent
 - Propsy, które komponent przyjmuje od rodzica (interfejs komponentu)
5. Typy: Szczegółowy opis typów wymaganych do implementacji widoku, w tym dokładny podział wszelkich nowych typów lub modeli widoku według pól i typów.
6. Zarządzanie stanem: Szczegółowy opis sposobu zarządzania stanem w widoku, określenie, czy wymagany jest customowy hook.
7. Integracja API: Wyjaśnienie sposobu integracji z dostarczonym punktem końcowym. Precyzyjnie wskazuje typy żądania i odpowiedzi.
8. Interakcje użytkownika: Szczegółowy opis interakcji użytkownika i sposobu ich obsługi.
9. Warunki i walidacja: Opisz jakie warunki są weryfikowane przez interfejs, których komponentów dotyczą i jak wpływają one na stan interfejsu
10. Obsługa błędów: Opis sposobu obsługi potencjalnych błędów lub przypadków brzegowych.
11. Kroki implementacji: Przewodnik krok po kroku dotyczący implementacji widoku.

Upewnij się, że Twój plan jest zgodny z PRD, historyjkami użytkownika i uwzględnia dostarczony stack technologiczny.

Ostateczne wyniki powinny być w języku polskim i zapisane w pliku o nazwie .ai/{view-name}-view-implementation-plan.md. Nie uwzględniaj żadnej analizy i planowania w końcowym wyniku.

Oto przykład tego, jak powinien wyglądać plik wyjściowy (treść jest do zastąpienia):

```markdown
# Plan implementacji widoku [Nazwa widoku]

## 1. Przegląd
[Krótki opis widoku i jego celu]

## 2. Routing widoku
[Ścieżka, na której widok powinien być dostępny]

## 3. Struktura komponentów
[Zarys głównych komponentów i ich hierarchii]

## 4. Szczegóły komponentów
### [Nazwa komponentu 1]
- Opis komponentu [opis]
- Główne elementy: [opis]
- Obsługiwane interakcje: [lista]
- Obsługiwana walidacja: [lista, szczegółowa]
- Typy: [lista]
- Propsy: [lista]

### [Nazwa komponentu 2]
[...]

## 5. Typy
[Szczegółowy opis wymaganych typów]

## 6. Zarządzanie stanem
[Opis zarządzania stanem w widoku]

## 7. Integracja API
[Wyjaśnienie integracji z dostarczonym endpointem, wskazanie typów żądania i odpowiedzi]

## 8. Interakcje użytkownika
[Szczegółowy opis interakcji użytkownika]

## 9. Warunki i walidacja
[Szczegółowy opis warunków i ich walidacji]

## 10. Obsługa błędów
[Opis obsługi potencjalnych błędów]

## 11. Kroki implementacji
1. [Krok 1]
2. [Krok 2]
3. [...]
```

Rozpocznij analizę i planowanie już teraz. Twój ostateczny wynik powinien składać się wyłącznie z planu wdrożenia w języku polskim w formacie markdown, który zapiszesz w pliku .ai/{view-name}-view-implementation-plan.md i nie powinien powielać ani powtarzać żadnej pracy wykonanej w podziale implementacji.